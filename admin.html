<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ì—Ä–∞—Ñ–∏–∫ —Å–º–µ–Ω</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .admin-header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
        }
        
        .admin-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        input[type="text"],
        input[type="number"],
        input[type="datetime-local"],
        input[type="url"],
        textarea,
        select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="number"] {
            width: 100px;
        }
        
        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: monospace;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è */
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #4caf50;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .toggle-label {
            font-weight: 600;
            color: #333;
            flex: 1;
        }
        
        .hours-input-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .button {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .button.secondary {
            background: #48bb78;
        }
        
        .button.secondary:hover {
            background: #38a169;
        }
        
        .button.danger {
            background: #f56565;
        }
        
        .button.danger:hover {
            background: #e53e3e;
        }
        
        .button.warning {
            background: #ed8936;
        }
        
        .button.warning:hover {
            background: #dd6b20;
        }
        
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .status-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 16px;
        }
        
        .status-indicator .icon {
            font-size: 24px;
        }
        
        .status-indicator.active {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .status-indicator.inactive {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .status-indicator.scheduled {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeeba;
        }
        
        .status-details {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            font-size: 14px;
            color: #666;
            line-height: 1.8;
        }
        
        .status-details strong {
            color: #333;
        }
        
        .current-time {
            margin-top: 10px;
            padding: 10px;
            background: #e8f4fd;
            border-radius: 6px;
            font-size: 14px;
            color: #0066cc;
        }
        
        .live-time {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 16px;
            color: #0052cc;
        }
        
        .week-schedule-info {
            background: #f0f8ff;
            border: 2px solid #4a90e2;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .week-schedule-info h4 {
            color: #2c5282;
            margin-bottom: 10px;
        }
        
        .danger-zone {
            background: #fff5f5;
            border: 2px solid #f56565;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .danger-zone h4 {
            color: #c53030;
            margin-bottom: 10px;
        }
        
        /* –ü—Ä–æ—Ç–æ–∫–æ–ª –¥–µ–π—Å—Ç–≤–∏–π */
        .logs-container {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
        }
        
        .log-entry {
            padding: 5px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .log-entry:hover {
            background: #fff;
        }
        
        .log-booked {
            color: #22543d;
            background: #f0fff4;
        }
        
        .log-cancelled {
            color: #742a2a;
            background: #fff5f5;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π */
        .requirements-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .requirements-table th,
        .requirements-table td {
            border: 1px solid #e0e0e0;
            text-align: center;
            padding: 4px;
        }
        
        .requirements-table th {
            background: #f8f9fa;
            font-weight: 600;
            font-size: 12px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .requirements-table th.day-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 14px;
            padding: 10px;
        }
        
        .requirements-table td.day-name {
            background: #f0f0f0;
            font-weight: 600;
            padding: 10px;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            width: 40px;
        }
        
        .requirement-cell {
            padding: 2px;
        }
        
        .requirement-cell-input {
            width: 35px;
            height: 30px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            padding: 2px;
        }
        
        .requirement-cell-input:focus {
            border-color: #667eea;
            outline: none;
            background: #f0f8ff;
        }
        
        .hour-label {
            font-size: 10px;
            color: #666;
            margin-bottom: 2px;
        }
        
        .requirements-container {
            overflow-x: auto;
            max-width: 100%;
            margin-top: 20px;
        }
        
        .employees-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .employee-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            margin-bottom: 8px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }
        
        .employee-item:hover {
            background: #f0f0f0;
        }
        
        .employee-name {
            flex: 1;
        }
        
        .delete-btn {
            padding: 5px 10px;
            background: #f56565;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .delete-btn:hover {
            background: #e53e3e;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            animation: slideIn 0.3s;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .toast.success {
            background: #48bb78;
        }
        
        .toast.error {
            background: #f56565;
        }
        
        .toast.info {
            background: #4299e1;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: #333;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .info-box {
            background: #ebf8ff;
            border: 1px solid #90cdf4;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .info-box h4 {
            color: #2c5282;
            margin-bottom: 10px;
        }
        
        .info-box p {
            color: #2d3748;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–º</h1>
            <p class="subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∏ —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</p>
        </div>
        
        <!-- –¢–∞–±—ã -->
        <div class="admin-section">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('schedule')">üìÖ –ì—Ä–∞—Ñ–∏–∫</button>
                <button class="tab" onclick="switchTab('employees')">üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</button>
                <button class="tab" onclick="switchTab('requirements')">üìä –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è</button>
                <button class="tab" onclick="switchTab('export')">üì• –≠–∫—Å–ø–æ—Ä—Ç</button>
                <button class="tab" onclick="switchTab('logs')">üìã –ü—Ä–æ—Ç–æ–∫–æ–ª</button>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –ì—Ä–∞—Ñ–∏–∫ -->
<div id="schedule-tab" class="tab-content active">
    <h2 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –∫ –≥—Ä–∞—Ñ–∏–∫—É</h2>
    
    <div class="form-group">
        <label for="weekStartDay">–î–µ–Ω—å –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—á–µ–π –Ω–µ–¥–µ–ª–∏:</label>
        <select id="weekStartDay" onchange="updateWeekStartDay()">
            <option value="1">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
            <option value="2">–í—Ç–æ—Ä–Ω–∏–∫</option>
            <option value="3">–°—Ä–µ–¥–∞</option>
            <option value="4">–ß–µ—Ç–≤–µ—Ä–≥</option>
            <option value="5">–ü—è—Ç–Ω–∏—Ü–∞</option>
            <option value="6">–°—É–±–±–æ—Ç–∞</option>
            <option value="0">–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</option>
        </select>
    </div>
    
    <div class="form-group">
        <label for="scheduleOpenFrom">–ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
        <input type="datetime-local" id="scheduleOpenFrom">
    </div>
    
    <div class="form-group">
        <label for="scheduleOpenUntil">–ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
        <input type="datetime-local" id="scheduleOpenUntil">
    </div>
    
    <!-- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å–æ–≤ -->
    <div class="toggle-container">
        <label class="toggle-switch">
            <input type="checkbox" id="maxHoursToggle" onchange="toggleMaxHours()">
            <span class="toggle-slider"></span>
        </label>
        <div class="toggle-label">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —á–∞—Å–æ–≤ –≤ –Ω–µ–¥–µ–ª—é</div>
        <div class="hours-input-container">
            <label style="margin: 0;">–ú–∞–∫—Å. —á–∞—Å–æ–≤:</label>
            <input type="number" id="maxHoursLimit" min="1" max="168" value="30" disabled>
        </div>
    </div>
    
    <button class="button" onclick="updateScheduleSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    
    <div class="week-schedule-info">
        <h4>üìÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—á–µ–π –Ω–µ–¥–µ–ª–µ:</h4>
        <div id="weekInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç—É—Å–∞ -->
    <div class="status-panel">
        <div id="scheduleStatus" class="status-indicator">
            <span class="icon">‚è≥</span>
            <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...</span>
        </div>
        
        <div class="status-details">
            <strong>–î–µ—Ç–∞–ª–∏:</strong><br>
            <div id="statusDetails">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        
        <div class="current-time">
            üïê –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (–ú–æ—Å–∫–≤–∞): <span id="currentServerTime" class="live-time">--:--:--</span>
        </div>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –≤–Ω–∏–∑—É -->
    <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
        <p style="color: #666; margin-bottom: 15px;">
            <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:</strong> –û—á–∏—Å—Ç–∫–∞ —É–¥–∞–ª–∏—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –≥—Ä–∞—Ñ–∏–∫–µ. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ 

–Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!
        </p>
        <button class="button danger" onclick="clearAllBookings()">
            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –≥—Ä–∞—Ñ–∏–∫–∞
        </button>
    </div>
</div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ -->
            <div id="employees-tab" class="tab-content">
                <h2 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>
                
                <div class="info-box">
                    <h4>üìù –°–ø–æ—Å–æ–±—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:</h4>
                    <p>1. –í—Ä—É—á–Ω—É—é –ø–æ –æ–¥–Ω–æ–º—É<br>
                    2. –ó–∞–≥—Ä—É–∑–∏—Ç—å Excel —Ñ–∞–π–ª (.xlsx)<br>
                    3. –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ (–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å-–≤—Å—Ç–∞–≤–∏—Ç—å)</p>
                </div>
                
                <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é -->
                <div class="form-group">
                    <label for="newEmployeeName">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤—Ä—É—á–Ω—É—é:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newEmployeeName" placeholder="–§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞" 

style="flex: 1;">
                        <button class="button secondary" onclick="addEmployee()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                </div>
                
                <!-- –ó–∞–≥—Ä—É–∑–∫–∞ Excel -->
                <div class="form-group">
                    <label>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Excel —Ñ–∞–π–ª–∞:</label>
                    <div class="file-input-wrapper">
                        <button class="button secondary">üìÅ –í—ã–±—Ä–∞—Ç—å Excel —Ñ–∞–π–ª</button>
                        <input type="file" class="file-input" accept=".xlsx,.xls" 

onchange="handleExcelFile(this)">
                    </div>
                </div>
                
                <!-- –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ -->
                <div class="form-group">
                    <label for="bulkEmployees">–ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ (–∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏):</label>
                    <textarea id="bulkEmployees" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á
–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á
–°–∏–¥–æ—Ä–æ–≤ –°–∏–¥–æ—Ä –°–∏–¥–æ—Ä–æ–≤–∏—á"></textarea>
                    <button class="button secondary" onclick="addBulkEmployees()">+ –î–æ–±–∞–≤–∏—Ç—å 

–≤—Å–µ—Ö</button>
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
                <div class="form-group">
                    <label>–¢–µ–∫—É—â–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ (<span id="employeeCount">0</span>):</label>
                    <div class="employees-list" id="employeesList">
                        <!-- –°–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
                
                <button class="button danger" onclick="clearAllEmployees()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö 

—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</button>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è -->
            <div id="requirements-tab" class="tab-content">
                <h2 class="section-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –ø–æ —á–∞—Å–∞–º –Ω–∞ –Ω–µ–¥–µ–ª—é</h2>
                
                <div class="info-box">
                    <h4>üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h4>
                    <p>–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–±—É–µ–º—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Å–∞.<br>
                    –ù–µ–¥–µ–ª—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –¥–Ω—è, —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ì—Ä–∞—Ñ–∏–∫".</p>
                </div>
                
                <div class="requirements-container">
                    <table class="requirements-table" id="requirementsTable">
                        <!-- –¢–∞–±–ª–∏—Ü–∞ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </table>
                </div>
                
                <button class="button" onclick="saveAllRequirements()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ 

—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è</button>
                <button class="button secondary" onclick="copyDayRequirements()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å 

–¥–µ–Ω—å</button>
                <button class="button secondary" onclick="pasteDayRequirements()">üìù –í—Å—Ç–∞–≤–∏—Ç—å 

–¥–µ–Ω—å</button>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –≠–∫—Å–ø–æ—Ä—Ç -->
            <div id="export-tab" class="tab-content">
                <h2 class="section-title">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h2>
                
                <div class="info-box">
                    <h4>üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∞:</h4>
                    <p>Excel (.xlsx) - –ø–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –≥—Ä–∞—Ñ–∏–∫–æ–º<br>
                    CSV - –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ –¥—Ä—É–≥–∏–µ —Å–∏—Å—Ç–µ–º—ã<br>
                    JSON - –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏<br>
                    TXT - –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–µ–π—Å—Ç–≤–∏–π</p>
                </div>
                
                <div class="form-group">
                    <label for="exportDateRange">–ü–µ—Ä–∏–æ–¥ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="date" id="exportDateFrom" style="flex: 1;">
                        <input type="date" id="exportDateTo" style="flex: 1;">
                    </div>
                </div>
                
                <button class="button" onclick="exportToExcel()">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
                <button class="button secondary" onclick="exportToCSV()">üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
                <button class="button secondary" onclick="exportToJSON()">{ } –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>
                
                <div class="form-group" style="margin-top: 30px;">
                    <label>–ë—ã—Å—Ç—Ä—ã–π —ç–∫—Å–ø–æ—Ä—Ç:</label>
                    <button class="button" onclick="exportCurrentWeek()">üìÖ –¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è</button>
                    <button class="button secondary" onclick="exportNextWeek()">üìÖ –°–ª–µ–¥—É—é—â–∞—è 

–Ω–µ–¥–µ–ª—è</button>
                </div>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –ü—Ä–æ—Ç–æ–∫–æ–ª -->
            <div id="logs-tab" class="tab-content">
                <h2 class="section-title">–ü—Ä–æ—Ç–æ–∫–æ–ª –¥–µ–π—Å—Ç–≤–∏–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>
                
                <div class="info-box">
                    <h4>üìã –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π:</h4>
                    <p>–ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏ –æ—Ç–º–µ–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å —Ç–æ—á–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º.</p>
                </div>
                
                <div class="form-group">
                    <button class="button" onclick="loadActionLogs()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª</button>
                    <button class="button secondary" onclick="exportLogs()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ TXT</button>
                    <button class="button warning" onclick="clearLogs()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª</button>
                </div>
                
                <div class="logs-container" id="logsContainer">
                    <!-- –õ–æ–≥–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ Supabase
        const SUPABASE_URL = 'https://gyraftcengparsbayrll.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_beR5cMb5U2NQUEwJ1Not2g_16xOcp1V';
        
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let currentTab = 'schedule';
        let employees = [];
        let currentRequirements = {};
        let scheduleSettings = {};
        let liveTimeInterval = null;
        let copiedDayRequirements = null;
        let actionLogs = [];
        
        const daysOfWeek = ['–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', 

'–°—É–±–±–æ—Ç–∞'];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            loadEmployees();
            setDefaultDates();
            startLiveClock();
        });
        
        // –ñ–∏–≤—ã–µ —á–∞—Å—ã
        function startLiveClock() {
            updateLiveTime();
            liveTimeInterval = setInterval(updateLiveTime, 1000);
        }
        
        function updateLiveTime() {
            const now = new Date();
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è (UTC+3)
            const moscowTime = new Date(now.toLocaleString("en-US", {timeZone: "Europe/Moscow"}));
            
            const timeEl = document.getElementById('currentServerTime');
            if (timeEl) {
                timeEl.textContent = moscowTime.toLocaleString('ru-RU', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
            if (moscowTime.getSeconds() === 0) {
                updateScheduleStatus();
            }
        }
        
        function switchTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—Å–µ —Ç–∞–±—ã
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
            event.target.classList.add('active');
            
            currentTab = tabName;
            
            if (tabName === 'requirements') {
                generateRequirementsTable();
                loadWeekRequirements();
            } else if (tabName === 'logs') {
                loadActionLogs();
            }
        }
        
        async function loadSettings() {
            try {
                const { data, error } = await supabaseClient
                    .from('system_settings')
                    .select('*');
                
                if (error) throw error;
                
                data.forEach(setting => {
                    scheduleSettings[setting.setting_key] = setting.setting_value;
                    
                    if (setting.setting_key === 'schedule_open_from') {
                        document.getElementById('scheduleOpenFrom').value = 
                            setting.setting_value.replace(' ', 'T').substring(0, 16);
                    }
                    if (setting.setting_key === 'schedule_open_until') {
                        document.getElementById('scheduleOpenUntil').value = 
                            setting.setting_value.replace(' ', 'T').substring(0, 16);
                    }
                    if (setting.setting_key === 'week_start_day') {
                        document.getElementById('weekStartDay').value = setting.setting_value || '1';
                    }
                    if (setting.setting_key === 'max_hours_enabled') {
                        const checkbox = document.getElementById('maxHoursToggle');
                        checkbox.checked = setting.setting_value === 'true';
                        document.getElementById('maxHoursLimit').disabled = !checkbox.checked;
                    }
                    if (setting.setting_key === 'max_hours_limit') {
                        document.getElementById('maxHoursLimit').value = setting.setting_value || '30';
                    }
                });
                
                updateScheduleStatus();
                updateWeekInfo();
                
            } catch (error) {
                console.error('Error loading settings:', error);
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'error');
            }
        }
        
        function toggleMaxHours() {
            const checkbox = document.getElementById('maxHoursToggle');
            const input = document.getElementById('maxHoursLimit');
            input.disabled = !checkbox.checked;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É
            updateMaxHoursSettings();
        }
        
        async function updateMaxHoursSettings() {
            const enabled = document.getElementById('maxHoursToggle').checked;
            const limit = document.getElementById('maxHoursLimit').value;
            
            try {
                await supabaseClient
                    .from('system_settings')
                    .update({ 
                        setting_value: enabled.toString(),
                        updated_at: new Date().toISOString()
                    })
                    .eq('setting_key', 'max_hours_enabled');
                
                await supabaseClient
                    .from('system_settings')
                    .update({ 
                        setting_value: limit,
                        updated_at: new Date().toISOString()
                    })
                    .eq('setting_key', 'max_hours_limit');
                
                showToast('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
            } catch (error) {
                console.error('Error updating max hours settings:', error);
                showToast('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'error');
            }
        }
        
async function clearAllBookings() {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –∑–∞–ø–∏—Å–∏ –∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–õ–¨–ó–Ø 

–æ—Ç–º–µ–Ω–∏—Ç—å!')) {
        return;
    }
    
    if (!confirm('–≠—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ!\n\n–í–°–ï –∑–∞–ø–∏—Å–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –≥—Ä–∞—Ñ–∏–∫–µ –±—É–¥—É—Ç –£–î–ê–õ–ï–ù–´!\n–°–∞–º–∏ 

—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ.\n\n–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
        return;
    }
    
    try {
        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é
        const { data, error } = await supabaseClient.rpc('clear_all_bookings');
        
        if (error) {
            // –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —É–¥–∞–ª—è–µ–º –Ω–∞–ø—Ä—è–º—É—é
            console.error('RPC error:', error);
            
            // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ - –ø—Ä—è–º–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
            const { data: deleteData, error: deleteError } = await supabaseClient
                .from('schedule_bookings')
                .delete()
                .neq('id', 0); // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏
            
            if (deleteError) throw deleteError;
            
            // –õ–æ–≥–∏—Ä—É–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
            await supabaseClient
                .from('action_logs')
                .insert({
                    employee_name: 'ADMIN',
                    action_type: 'clear_all',
                    created_at: new Date().toISOString()
                });
            
            showToast('–í—Å–µ –∑–∞–ø–∏—Å–∏ –≥—Ä–∞—Ñ–∏–∫–∞ —É–¥–∞–ª–µ–Ω—ã', 'success');
        } else {
            showToast(data.message || '–ó–∞–ø–∏—Å–∏ —É–¥–∞–ª–µ–Ω—ã', 'success');
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ç–æ–∫–æ–ª –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç
        if (currentTab === 'logs') {
            loadActionLogs();
        }
    } catch (error) {
        console.error('Error clearing bookings:', error);
        showToast('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∑–∞–ø–∏—Å–µ–π: ' + error.message, 'error');
    }
}
        
        async function loadActionLogs() {
            try {
                const { data, error } = await supabaseClient
                    .from('action_logs')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(500);
                
                if (error) throw error;
                
                actionLogs = data;
                displayLogs();
            } catch (error) {
                console.error('Error loading logs:', error);
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞', 'error');
            }
        }
        
        function displayLogs() {
            const container = document.getElementById('logsContainer');
            
            if (actionLogs.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999;">–ü—Ä–æ—Ç–æ–∫–æ–ª 

–ø—É—Å—Ç</div>';
                return;
            }
            
            let html = '';
            actionLogs.forEach(log => {
                const date = new Date(log.created_at);
                const actionText = log.action_type === 'booked' ? '‚úÖ –ó–∞–ø–∏—Å–∞–ª—Å—è' : 
                                   log.action_type === 'cancelled' ? '‚ùå –û—Ç–º–µ–Ω–∏–ª' :
                                   log.action_type === 'clear_all' ? 'üóëÔ∏è –û–ß–ò–°–¢–ö–ê –í–°–ï–• –ó–ê–ü–ò–°–ï–ô' : 

log.action_type;
                
                const className = log.action_type === 'booked' ? 'log-booked' : 'log-cancelled';
                
                if (log.action_type === 'clear_all') {
                    html += `
                        <div class="log-entry" style="background: #ffe0b2; color: #e65100; font-weight: 

bold;">
                            ${date.toLocaleString('ru-RU')} - –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–† - –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π
                        </div>
                    `;
                } else {
                    html += `
                        <div class="log-entry ${className}">
                            ${date.toLocaleString('ru-RU')} - ${log.employee_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'} - 

${actionText} 
                            ${log.date ? `–Ω–∞ ${log.date}` : ''} 
                            ${log.hour_slot !== null ? `${log.hour_slot}:00-${log.hour_slot + 1}:00` : 

''}
                        </div>
                    `;
                }
            });
            
            container.innerHTML = html;
        }
        
        async function exportLogs() {
            if (actionLogs.length === 0) {
                showToast('–ü—Ä–æ—Ç–æ–∫–æ–ª –ø—É—Å—Ç', 'error');
                return;
            }
            
            let text = '–ü–†–û–¢–û–ö–û–õ –î–ï–ô–°–¢–í–ò–ô –°–û–¢–†–£–î–ù–ò–ö–û–í\n';
            text += '================================\n\n';
            text += `–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω: ${new Date().toLocaleString('ru-RU')}\n\n`;
            
            actionLogs.forEach(log => {
                const date = new Date(log.created_at);
                const actionText = log.action_type === 'booked' ? '–ó–∞–ø–∏—Å–∞–ª—Å—è' : 
                                   log.action_type === 'cancelled' ? '–û—Ç–º–µ–Ω–∏–ª' :
                                   log.action_type === 'clear_all' ? '–û–ß–ò–°–¢–ö–ê –í–°–ï–• –ó–ê–ü–ò–°–ï–ô' : 

log.action_type;
                
                if (log.action_type === 'clear_all') {
                    text += `\n*** ${date.toLocaleString('ru-RU')} - –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–† - ${actionText} ***

\n\n`;
                } else {
                    text += `${date.toLocaleString('ru-RU')} - ${log.employee_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'} - 

${actionText}`;
                    if (log.date) text += ` –Ω–∞ ${log.date}`;
                    if (log.hour_slot !== null) text += ` ${log.hour_slot}:00-${log.hour_slot + 1}:00`;
                    text += '\n';
                }
            });
            
            // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `–ü—Ä–æ—Ç–æ–∫–æ–ª_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            
            showToast('–ü—Ä–æ—Ç–æ–∫–æ–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω', 'success');
        }
        
        async function clearLogs() {
            if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–µ–π—Å—Ç–≤–∏–π?')) {
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('action_logs')
                    .delete()
                    .neq('id', 0); // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏
                
                if (error) throw error;
                
                actionLogs = [];
                displayLogs();
                showToast('–ü—Ä–æ—Ç–æ–∫–æ–ª –æ—á–∏—â–µ–Ω', 'success');
            } catch (error) {
                console.error('Error clearing logs:', error);
                showToast('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞', 'error');
            }
        }
        
        function updateWeekInfo() {
            const weekStartDay = parseInt(document.getElementById('weekStartDay').value || '1');
            const today = new Date();
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏
            const daysUntilStart = (weekStartDay - today.getDay() + 7) % 7 || 7;
            const nextWeekStart = new Date(today);
            nextWeekStart.setDate(today.getDate() + daysUntilStart);
            
            const nextWeekEnd = new Date(nextWeekStart);
            nextWeekEnd.setDate(nextWeekStart.getDate() + 6);
            
            const weekInfoEl = document.getElementById('weekInfo');
            weekInfoEl.innerHTML = `
                <strong>–°–ª–µ–¥—É—é—â–∞—è —Ä–∞–±–æ—á–∞—è –Ω–µ–¥–µ–ª—è:</strong><br>
                –° ${daysOfWeek[weekStartDay]} ${nextWeekStart.toLocaleDateString('ru-RU')}<br>
                –ü–æ ${daysOfWeek[(weekStartDay + 6) % 7]} ${nextWeekEnd.toLocaleDateString('ru-RU')}
            `;
        }
        
        async function updateWeekStartDay() {
            const weekStartDay = document.getElementById('weekStartDay').value;
            
            try {
                const { error } = await supabaseClient
                    .from('system_settings')
                    .update({ 
                        setting_value: weekStartDay,
                        updated_at: new Date().toISOString()
                    })
                    .eq('setting_key', 'week_start_day');
                
                if (!error) {
                    // –ï—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –µ—ë
                    await supabaseClient
                        .from('system_settings')
                        .upsert({ 
                            setting_key: 'week_start_day',
                            setting_value: weekStartDay
                        });
                }
                
                updateWeekInfo();
                showToast('–î–µ–Ω—å –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏ –æ–±–Ω–æ–≤–ª—ë–Ω', 'success');
            } catch (error) {
                console.error('Error updating week start day:', error);
                showToast('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', 'error');
            }
        }
        
        function updateScheduleStatus() {
            const now = new Date();
            // –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è
            const moscowNow = new Date(now.toLocaleString("en-US", {timeZone: "Europe/Moscow"}));
            
            const statusEl = document.getElementById('scheduleStatus');
            const detailsEl = document.getElementById('statusDetails');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            if (!scheduleSettings.schedule_open_from || !scheduleSettings.schedule_open_until) {
                statusEl.className = 'status-indicator inactive';
                statusEl.innerHTML = `
                    <span class="icon">‚ö†Ô∏è</span>
                    <span>–ü–µ—Ä–∏–æ–¥ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω</span>
                `;
                detailsEl.innerHTML = '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è';
                return;
            }
            
            const openFrom = new Date(scheduleSettings.schedule_open_from);
            const openUntil = new Date(scheduleSettings.schedule_open_until);
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            if (moscowNow < openFrom) {
                // –ì—Ä–∞—Ñ–∏–∫ –µ—â—ë –Ω–µ –æ—Ç–∫—Ä—ã—Ç
                const msUntilOpen = openFrom - moscowNow;
                const daysUntilOpen = Math.floor(msUntilOpen / (1000 * 60 * 60 * 24));
                const hoursUntilOpen = Math.floor((msUntilOpen % (1000 * 60 * 60 * 24)) / (1000 * 60 * 

60));
                const minutesUntilOpen = Math.floor((msUntilOpen % (1000 * 60 * 60)) / (1000 * 60));
                
                statusEl.className = 'status-indicator scheduled';
                statusEl.innerHTML = `
                    <span class="icon">‚è∞</span>
                    <span>–ì—Ä–∞—Ñ–∏–∫ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ–∑–∂–µ</span>
                `;
                
                let timeLeftStr = '';
                if (daysUntilOpen > 0) timeLeftStr += `${daysUntilOpen} –¥–Ω. `;
                timeLeftStr += `${hoursUntilOpen} —á. ${minutesUntilOpen} –º–∏–Ω.`;
                
                detailsEl.innerHTML = `
                    <strong>–ü–µ—Ä–∏–æ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong><br>
                    –° ${openFrom.toLocaleString('ru-RU')}<br>
                    –ü–æ ${openUntil.toLocaleString('ru-RU')}<br><br>
                    <strong>–î–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –æ—Å—Ç–∞–ª–æ—Å—å:</strong> ${timeLeftStr}
                `;
                
            } else if (moscowNow >= openFrom && moscowNow <= openUntil) {
                // –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–µ–Ω
                const msLeft = openUntil - moscowNow;
                const daysLeft = Math.floor(msLeft / (1000 * 60 * 60 * 24));
                const hoursLeft = Math.floor((msLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutesLeft = Math.floor((msLeft % (1000 * 60 * 60)) / (1000 * 60));
                
                statusEl.className = 'status-indicator active';
                statusEl.innerHTML = `
                    <span class="icon">‚úÖ</span>
                    <span>–ì—Ä–∞—Ñ–∏–∫ –û–¢–ö–†–´–¢ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</span>
                `;
                
                let timeLeftStr = '';
                if (daysLeft > 0) timeLeftStr += `${daysLeft} –¥–Ω. `;
                timeLeftStr += `${hoursLeft} —á. ${minutesLeft} –º–∏–Ω.`;
                
                detailsEl.innerHTML = `
                    <strong>–ü–µ—Ä–∏–æ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong><br>
                    –° ${openFrom.toLocaleString('ru-RU')}<br>
                    –ü–æ ${openUntil.toLocaleString('ru-RU')}<br><br>
                    <strong>–î–æ –∑–∞–∫—Ä—ã—Ç–∏—è –æ—Å—Ç–∞–ª–æ—Å—å:</strong> ${timeLeftStr}<br><br>
                    ${scheduleSettings.max_hours_enabled === 'true' ? 
                      `<strong>‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:</strong> –º–∞–∫—Å. ${scheduleSettings.max_hours_limit} —á–∞—Å–æ–≤ –≤ 

–Ω–µ–¥–µ–ª—é` : ''}
                `;
                
            } else {
                // –ì—Ä–∞—Ñ–∏–∫ –∑–∞–∫—Ä—ã—Ç
                statusEl.className = 'status-indicator inactive';
                statusEl.innerHTML = `
                    <span class="icon">üîí</span>
                    <span>–ì—Ä–∞—Ñ–∏–∫ –ó–ê–ö–†–´–¢</span>
                `;
                
                detailsEl.innerHTML = `
                    <strong>–ü–µ—Ä–∏–æ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à—ë–Ω</strong><br>
                    –ë—ã–ª –æ—Ç–∫—Ä—ã—Ç —Å ${openFrom.toLocaleString('ru-RU')}<br>
                    –ø–æ ${openUntil.toLocaleString('ru-RU')}<br><br>
                    –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≥—Ä–∞—Ñ–∏–∫–∞.
                `;
            }
        }
        
        async function updateScheduleSettings() {
            const openFrom = document.getElementById('scheduleOpenFrom').value;
            const openUntil = document.getElementById('scheduleOpenUntil').value;
            const maxHoursEnabled = document.getElementById('maxHoursToggle').checked;
            const maxHoursLimit = document.getElementById('maxHoursLimit').value;
            
            if (!openFrom || !openUntil) {
                showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±–∞ –ø–æ–ª—è –≤—Ä–µ–º–µ–Ω–∏', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞—Ç
            if (new Date(openFrom) >= new Date(openUntil)) {
                showToast('–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–∑–∂–µ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞', 'error');
                return;
            }
            
            try {
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                const updates = [
                    { key: 'schedule_open_from', value: openFrom.replace('T', ' ') + ':00' },
                    { key: 'schedule_open_until', value: openUntil.replace('T', ' ') + ':00' },
                    { key: 'is_schedule_active', value: 'true' },
                    { key: 'max_hours_enabled', value: maxHoursEnabled.toString() },
                    { key: 'max_hours_limit', value: maxHoursLimit }
                ];
                
                for (const update of updates) {
                    const { error } = await supabaseClient
                        .from('system_settings')
                        .update({ 
                            setting_value: update.value,
                            updated_at: new Date().toISOString()
                        })
                        .eq('setting_key', update.key);
                    
                    if (error) throw error;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                scheduleSettings.schedule_open_from = openFrom.replace('T', ' ') + ':00';
                scheduleSettings.schedule_open_until = openUntil.replace('T', ' ') + ':00';
                scheduleSettings.is_schedule_active = 'true';
                scheduleSettings.max_hours_enabled = maxHoursEnabled.toString();
                scheduleSettings.max_hours_limit = maxHoursLimit;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                updateScheduleStatus();
                
                showToast('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
            } catch (error) {
                console.error('Error updating settings:', error);
                showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫: ' + error.message, 'error');
            }
        }
        
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, —ç–∫—Å–ø–æ—Ä—Ç) –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π...
        // [–ó–¥–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∏–∑–º–µ–Ω—è–ª—Å—è]
        
        async function loadEmployees() {
            try {
                const { data, error } = await supabaseClient
                    .from('employees')
                    .select('*')
                    .eq('is_active', true)
                    .order('sort_order');
                
                if (error) throw error;
                
                employees = data;
                updateEmployeesList();
            } catch (error) {
                console.error('Error loading employees:', error);
            }
        }
        
        function updateEmployeesList() {
            const listEl = document.getElementById('employeesList');
            const countEl = document.getElementById('employeeCount');
            
            countEl.textContent = employees.length;
            
            if (employees.length === 0) {
                listEl.innerHTML = '<p style="color: #999; text-align: center;">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</p>';
                return;
            }
            
            listEl.innerHTML = employees.map((emp, index) => `
                <div class="employee-item">
                    <span class="employee-name">${index + 1}. ${emp.full_name}</span>
                    <button class="delete-btn" onclick="deleteEmployee(${emp.id})">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `).join('');
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
        function generateRequirementsTable() {
            const weekStartDay = parseInt(document.getElementById('weekStartDay').value || '1');
            const today = new Date();
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏
            const daysUntilStart = (weekStartDay - today.getDay() + 7) % 7 || 7;
            const nextWeekStart = new Date(today);
            nextWeekStart.setDate(today.getDate() + daysUntilStart);
            
            let html = '<thead><tr><th>–î–µ–Ω—å</th>';
            
            // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —á–∞—Å–æ–≤
            for (let hour = 0; hour < 24; hour++) {
                html += `<th>${hour.toString().padStart(2, '0')}:00</th>`;
            }
            html += '</tr></thead><tbody>';
            
            // –°—Ç—Ä–æ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
            for (let day = 0; day < 7; day++) {
                const currentDate = new Date(nextWeekStart);
                currentDate.setDate(nextWeekStart.getDate() + day);
                const dateStr = currentDate.toISOString().split('T')[0];
                const dayName = daysOfWeek[currentDate.getDay()];
                
                html += `<tr>`;
                html += `<td class="day-name">${dayName}<br>${currentDate.toLocaleDateString('ru-RU', 

{day: 'numeric', month: 'numeric'})}</td>`;
                
                for (let hour = 0; hour < 24; hour++) {
                    html += `
                        <td class="requirement-cell">
                            <input type="number" 
                                   class="requirement-cell-input" 
                                   id="req_${dateStr}_${hour}"
                                   data-date="${dateStr}"
                                   data-hour="${hour}"
                                   min="0" 
                                   max="99"
                                   value="0">
                        </td>
                    `;
                }
                html += '</tr>';
            }
            html += '</tbody>';
            
            document.getElementById('requirementsTable').innerHTML = html;
        }
        
        function setDefaultDates() {
            const today = new Date();
            document.getElementById('exportDateFrom').value = today.toISOString().split('T')[0];
            document.getElementById('exportDateTo').value = new Date(today.getTime() + 6 * 24 * 60 * 60 

* 1000).toISOString().split('T')[0];
        }
        
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', () => {
            if (liveTimeInterval) {
                clearInterval(liveTimeInterval);
            }
        });
    </script>
</body>
</html>
