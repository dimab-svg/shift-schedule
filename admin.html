<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ì—Ä–∞—Ñ–∏–∫ —Å–º–µ–Ω</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .admin-header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
        }
        
        .admin-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .section-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        input[type="text"],
        input[type="datetime-local"],
        input[type="url"],
        textarea,
        select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: monospace;
        }
        
        .button {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .button.secondary {
            background: #48bb78;
        }
        
        .button.secondary:hover {
            background: #38a169;
        }
        
        .button.danger {
            background: #f56565;
        }
        
        .button.danger:hover {
            background: #e53e3e;
        }
        
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .status-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 16px;
        }
        
        .status-indicator .icon {
            font-size: 24px;
        }
        
        .status-indicator.active {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .status-indicator.inactive {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .status-indicator.scheduled {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeeba;
        }
        
        .status-details {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            font-size: 14px;
            color: #666;
            line-height: 1.8;
        }
        
        .status-details strong {
            color: #333;
        }
        
        .current-time {
            margin-top: 10px;
            padding: 10px;
            background: #e8f4fd;
            border-radius: 6px;
            font-size: 14px;
            color: #0066cc;
        }
        
        .live-time {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 16px;
            color: #0052cc;
        }
        
        .week-schedule-info {
            background: #f0f8ff;
            border: 2px solid #4a90e2;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .week-schedule-info h4 {
            color: #2c5282;
            margin-bottom: 10px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π */
        .requirements-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .requirements-table th,
        .requirements-table td {
            border: 1px solid #e0e0e0;
            text-align: center;
            padding: 4px;
        }
        
        .requirements-table th {
            background: #f8f9fa;
            font-weight: 600;
            font-size: 12px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .requirements-table th.day-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 14px;
            padding: 10px;
        }
        
        .requirements-table td.day-name {
            background: #f0f0f0;
            font-weight: 600;
            padding: 10px;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            width: 40px;
        }
        
        .requirement-cell {
            padding: 2px;
        }
        
        .requirement-cell-input {
            width: 35px;
            height: 30px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            padding: 2px;
        }
        
        .requirement-cell-input:focus {
            border-color: #667eea;
            outline: none;
            background: #f0f8ff;
        }
        
        .hour-label {
            font-size: 10px;
            color: #666;
            margin-bottom: 2px;
        }
        
        .requirements-container {
            overflow-x: auto;
            max-width: 100%;
            margin-top: 20px;
        }
        
        .employees-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .employee-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            margin-bottom: 8px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }
        
        .employee-item:hover {
            background: #f0f0f0;
        }
        
        .employee-name {
            flex: 1;
        }
        
        .delete-btn {
            padding: 5px 10px;
            background: #f56565;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .delete-btn:hover {
            background: #e53e3e;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            animation: slideIn 0.3s;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .toast.success {
            background: #48bb78;
        }
        
        .toast.error {
            background: #f56565;
        }
        
        .toast.info {
            background: #4299e1;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: #333;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .info-box {
            background: #ebf8ff;
            border: 1px solid #90cdf4;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .info-box h4 {
            color: #2c5282;
            margin-bottom: 10px;
        }
        
        .info-box p {
            color: #2d3748;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–º</h1>
            <p class="subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∏ —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</p>
        </div>
        
        <!-- –¢–∞–±—ã -->
        <div class="admin-section">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('schedule')">üìÖ –ì—Ä–∞—Ñ–∏–∫</button>
                <button class="tab" onclick="switchTab('employees')">üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</button>
                <button class="tab" onclick="switchTab('requirements')">üìä –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è</button>
                <button class="tab" onclick="switchTab('export')">üì• –≠–∫—Å–ø–æ—Ä—Ç</button>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –ì—Ä–∞—Ñ–∏–∫ -->
            <div id="schedule-tab" class="tab-content active">
                <h2 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –∫ –≥—Ä–∞—Ñ–∏–∫—É</h2>
                
                <div class="form-group">
                    <label for="weekStartDay">–î–µ–Ω—å –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—á–µ–π –Ω–µ–¥–µ–ª–∏:</label>
                    <select id="weekStartDay" onchange="updateWeekStartDay()">
                        <option value="1">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
                        <option value="2">–í—Ç–æ—Ä–Ω–∏–∫</option>
                        <option value="3">–°—Ä–µ–¥–∞</option>
                        <option value="4">–ß–µ—Ç–≤–µ—Ä–≥</option>
                        <option value="5">–ü—è—Ç–Ω–∏—Ü–∞</option>
                        <option value="6">–°—É–±–±–æ—Ç–∞</option>
                        <option value="0">–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="scheduleOpenFrom">–ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
                    <input type="datetime-local" id="scheduleOpenFrom">
                </div>
                
                <div class="form-group">
                    <label for="scheduleOpenUntil">–ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
                    <input type="datetime-local" id="scheduleOpenUntil">
                </div>
                
                <button class="button" onclick="updateScheduleSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                
                <div class="week-schedule-info">
                    <h4>üìÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—á–µ–π –Ω–µ–¥–µ–ª–µ:</h4>
                    <div id="weekInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                
                <!-- –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç—É—Å–∞ -->
                <div class="status-panel">
                    <div id="scheduleStatus" class="status-indicator">
                        <span class="icon">‚è≥</span>
                        <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...</span>
                    </div>
                    
                    <div class="status-details">
                        <strong>–î–µ—Ç–∞–ª–∏:</strong><br>
                        <div id="statusDetails">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                    
                    <div class="current-time">
                        üïê –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è (–ú–æ—Å–∫–≤–∞): <span id="currentServerTime" class="live-time">--:--:--</span>
                    </div>
                </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –≤–Ω–∏–∑—É -->
    <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
        <p style="color: #666; margin-bottom: 15px;">
            <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:</strong> –û—á–∏—Å—Ç–∫–∞ —É–¥–∞–ª–∏—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –≥—Ä–∞—Ñ–∏–∫–µ. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!
        </p>
        <button class="button danger" onclick="clearAllBookings()">
            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –≥—Ä–∞—Ñ–∏–∫–∞
        </button>
    </div>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ -->
            <div id="employees-tab" class="tab-content">
                <h2 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>
                
                <div class="info-box">
                    <h4>üìù –°–ø–æ—Å–æ–±—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:</h4>
                    <p>1. –í—Ä—É—á–Ω—É—é –ø–æ –æ–¥–Ω–æ–º—É<br>
                    2. –ó–∞–≥—Ä—É–∑–∏—Ç—å Excel —Ñ–∞–π–ª (.xlsx)<br>
                    3. –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ (–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å-–≤—Å—Ç–∞–≤–∏—Ç—å)</p>
                </div>
                
                <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é -->
                <div class="form-group">
                    <label for="newEmployeeName">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤—Ä—É—á–Ω—É—é:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newEmployeeName" placeholder="–§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞" style="flex: 1;">
                        <button class="button secondary" onclick="addEmployee()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                </div>
                
                <!-- –ó–∞–≥—Ä—É–∑–∫–∞ Excel -->
                <div class="form-group">
                    <label>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Excel —Ñ–∞–π–ª–∞:</label>
                    <div class="file-input-wrapper">
                        <button class="button secondary">üìÅ –í—ã–±—Ä–∞—Ç—å Excel —Ñ–∞–π–ª</button>
                        <input type="file" class="file-input" accept=".xlsx,.xls" onchange="handleExcelFile(this)">
                    </div>
                </div>
                
                <!-- –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ -->
                <div class="form-group">
                    <label for="bulkEmployees">–ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ (–∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏):</label>
                    <textarea id="bulkEmployees" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á
–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á
–°–∏–¥–æ—Ä–æ–≤ –°–∏–¥–æ—Ä –°–∏–¥–æ—Ä–æ–≤–∏—á"></textarea>
                    <button class="button secondary" onclick="addBulkEmployees()">+ –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ—Ö</button>
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
                <div class="form-group">
                    <label>–¢–µ–∫—É—â–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ (<span id="employeeCount">0</span>):</label>
                    <div class="employees-list" id="employeesList">
                        <!-- –°–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
                
                <button class="button danger" onclick="clearAllEmployees()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</button>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è -->
            <div id="requirements-tab" class="tab-content">
                <h2 class="section-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –ø–æ —á–∞—Å–∞–º –Ω–∞ –Ω–µ–¥–µ–ª—é</h2>
                
                <div class="info-box">
                    <h4>üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h4>
                    <p>–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–±—É–µ–º—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Å–∞.<br>
                    –ù–µ–¥–µ–ª—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –¥–Ω—è, —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ì—Ä–∞—Ñ–∏–∫".</p>
                </div>
                
                <div class="requirements-container">
                    <table class="requirements-table" id="requirementsTable">
                        <!-- –¢–∞–±–ª–∏—Ü–∞ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </table>
                </div>
                
                <button class="button" onclick="saveAllRequirements()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è</button>
                <button class="button secondary" onclick="copyDayRequirements()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–µ–Ω—å</button>
                <button class="button secondary" onclick="pasteDayRequirements()">üìù –í—Å—Ç–∞–≤–∏—Ç—å –¥–µ–Ω—å</button>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –≠–∫—Å–ø–æ—Ä—Ç -->
            <div id="export-tab" class="tab-content">
                <h2 class="section-title">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h2>
                
                <div class="info-box">
                    <h4>üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∞:</h4>
                    <p>Excel (.xlsx) - –ø–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –≥—Ä–∞—Ñ–∏–∫–æ–º<br>
                    CSV - –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ –¥—Ä—É–≥–∏–µ —Å–∏—Å—Ç–µ–º—ã<br>
                    JSON - –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏</p>
                </div>
                
                <div class="form-group">
                    <label for="exportDateRange">–ü–µ—Ä–∏–æ–¥ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="date" id="exportDateFrom" style="flex: 1;">
                        <input type="date" id="exportDateTo" style="flex: 1;">
                    </div>
                </div>
                
                <button class="button" onclick="exportToExcel()">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
                <button class="button secondary" onclick="exportToCSV()">üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
                <button class="button secondary" onclick="exportToJSON()">{ } –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>
                
                <div class="form-group" style="margin-top: 30px;">
                    <label>–ë—ã—Å—Ç—Ä—ã–π —ç–∫—Å–ø–æ—Ä—Ç:</label>
                    <button class="button" onclick="exportCurrentWeek()">üìÖ –¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è</button>
                    <button class="button secondary" onclick="exportNextWeek()">üìÖ –°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ Supabase
        const SUPABASE_URL = 'https://gyraftcengparsbayrll.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_beR5cMb5U2NQUEwJ1Not2g_16xOcp1V';
        
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let currentTab = 'schedule';
        let employees = [];
        let currentRequirements = {};
        let scheduleSettings = {};
        let liveTimeInterval = null;
        let copiedDayRequirements = null;
        
        const daysOfWeek = ['–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞'];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            loadEmployees();
            setDefaultDates();
            startLiveClock();
        });
        
        // –ñ–∏–≤—ã–µ —á–∞—Å—ã
        function startLiveClock() {
            updateLiveTime();
            liveTimeInterval = setInterval(updateLiveTime, 1000);
        }
        
        function updateLiveTime() {
            const now = new Date();
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è (UTC+3)
            const moscowTime = new Date(now.toLocaleString("en-US", {timeZone: "Europe/Moscow"}));
            
            const timeEl = document.getElementById('currentServerTime');
            if (timeEl) {
                timeEl.textContent = moscowTime.toLocaleString('ru-RU', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
            if (moscowTime.getSeconds() === 0) {
                updateScheduleStatus();
            }
        }
        
        function switchTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—Å–µ —Ç–∞–±—ã
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
            event.target.classList.add('active');
            
            currentTab = tabName;
            
            if (tabName === 'requirements') {
                generateRequirementsTable();
                loadWeekRequirements();
            }
        }
        
        async function loadSettings() {
            try {
                const { data, error } = await supabaseClient
                    .from('system_settings')
                    .select('*');
                
                if (error) throw error;
                
                data.forEach(setting => {
                    scheduleSettings[setting.setting_key] = setting.setting_value;
                    
                    if (setting.setting_key === 'schedule_open_from') {
                        document.getElementById('scheduleOpenFrom').value = 
                            setting.setting_value.replace(' ', 'T').substring(0, 16);
                    }
                    if (setting.setting_key === 'schedule_open_until') {
                        document.getElementById('scheduleOpenUntil').value = 
                            setting.setting_value.replace(' ', 'T').substring(0, 16);
                    }
                    if (setting.setting_key === 'week_start_day') {
                        document.getElementById('weekStartDay').value = setting.setting_value || '1';
                    }
                });
                
                updateScheduleStatus();
                updateWeekInfo();
                
            } catch (error) {
                console.error('Error loading settings:', error);
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'error');
            }
        }
        
        function updateWeekInfo() {
            const weekStartDay = parseInt(document.getElementById('weekStartDay').value || '1');
            const today = new Date();
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏
            const daysUntilStart = (weekStartDay - today.getDay() + 7) % 7 || 7;
            const nextWeekStart = new Date(today);
            nextWeekStart.setDate(today.getDate() + daysUntilStart);
            
            const nextWeekEnd = new Date(nextWeekStart);
            nextWeekEnd.setDate(nextWeekStart.getDate() + 6);
            
            const weekInfoEl = document.getElementById('weekInfo');
            weekInfoEl.innerHTML = `
                <strong>–°–ª–µ–¥—É—é—â–∞—è —Ä–∞–±–æ—á–∞—è –Ω–µ–¥–µ–ª—è:</strong><br>
                –° ${daysOfWeek[weekStartDay]} ${nextWeekStart.toLocaleDateString('ru-RU')}<br>
                –ü–æ ${daysOfWeek[(weekStartDay + 6) % 7]} ${nextWeekEnd.toLocaleDateString('ru-RU')}
            `;
        }
        
        async function updateWeekStartDay() {
            const weekStartDay = document.getElementById('weekStartDay').value;
            
            try {
                const { error } = await supabaseClient
                    .from('system_settings')
                    .update({ 
                        setting_value: weekStartDay,
                        updated_at: new Date().toISOString()
                    })
                    .eq('setting_key', 'week_start_day');
                
                if (!error) {
                    // –ï—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –µ—ë
                    await supabaseClient
                        .from('system_settings')
                        .upsert({ 
                            setting_key: 'week_start_day',
                            setting_value: weekStartDay
                        });
                }
                
                updateWeekInfo();
                showToast('–î–µ–Ω—å –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏ –æ–±–Ω–æ–≤–ª—ë–Ω', 'success');
            } catch (error) {
                console.error('Error updating week start day:', error);
                showToast('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', 'error');
            }
        }
        
        function updateScheduleStatus() {
            const now = new Date();
            // –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è
            const moscowNow = new Date(now.toLocaleString("en-US", {timeZone: "Europe/Moscow"}));
            
            const statusEl = document.getElementById('scheduleStatus');
            const detailsEl = document.getElementById('statusDetails');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            if (!scheduleSettings.schedule_open_from || !scheduleSettings.schedule_open_until) {
                statusEl.className = 'status-indicator inactive';
                statusEl.innerHTML = `
                    <span class="icon">‚ö†Ô∏è</span>
                    <span>–ü–µ—Ä–∏–æ–¥ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω</span>
                `;
                detailsEl.innerHTML = '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è';
                return;
            }
            
            const openFrom = new Date(scheduleSettings.schedule_open_from);
            const openUntil = new Date(scheduleSettings.schedule_open_until);
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            if (moscowNow < openFrom) {
                // –ì—Ä–∞—Ñ–∏–∫ –µ—â—ë –Ω–µ –æ—Ç–∫—Ä—ã—Ç
                const msUntilOpen = openFrom - moscowNow;
                const daysUntilOpen = Math.floor(msUntilOpen / (1000 * 60 * 60 * 24));
                const hoursUntilOpen = Math.floor((msUntilOpen % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutesUntilOpen = Math.floor((msUntilOpen % (1000 * 60 * 60)) / (1000 * 60));
                
                statusEl.className = 'status-indicator scheduled';
                statusEl.innerHTML = `
                    <span class="icon">‚è∞</span>
                    <span>–ì—Ä–∞—Ñ–∏–∫ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ–∑–∂–µ</span>
                `;
                
                let timeLeftStr = '';
                if (daysUntilOpen > 0) timeLeftStr += `${daysUntilOpen} –¥–Ω. `;
                timeLeftStr += `${hoursUntilOpen} —á. ${minutesUntilOpen} –º–∏–Ω.`;
                
                detailsEl.innerHTML = `
                    <strong>–ü–µ—Ä–∏–æ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong><br>
                    –° ${openFrom.toLocaleString('ru-RU')}<br>
                    –ü–æ ${openUntil.toLocaleString('ru-RU')}<br><br>
                    <strong>–î–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –æ—Å—Ç–∞–ª–æ—Å—å:</strong> ${timeLeftStr}
                `;
                
            } else if (moscowNow >= openFrom && moscowNow <= openUntil) {
                // –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–µ–Ω
                const msLeft = openUntil - moscowNow;
                const daysLeft = Math.floor(msLeft / (1000 * 60 * 60 * 24));
                const hoursLeft = Math.floor((msLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutesLeft = Math.floor((msLeft % (1000 * 60 * 60)) / (1000 * 60));
                
                statusEl.className = 'status-indicator active';
                statusEl.innerHTML = `
                    <span class="icon">‚úÖ</span>
                    <span>–ì—Ä–∞—Ñ–∏–∫ –û–¢–ö–†–´–¢ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</span>
                `;
                
                let timeLeftStr = '';
                if (daysLeft > 0) timeLeftStr += `${daysLeft} –¥–Ω. `;
                timeLeftStr += `${hoursLeft} —á. ${minutesLeft} –º–∏–Ω.`;
                
                detailsEl.innerHTML = `
                    <strong>–ü–µ—Ä–∏–æ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong><br>
                    –° ${openFrom.toLocaleString('ru-RU')}<br>
                    –ü–æ ${openUntil.toLocaleString('ru-RU')}<br><br>
                    <strong>–î–æ –∑–∞–∫—Ä—ã—Ç–∏—è –æ—Å—Ç–∞–ª–æ—Å—å:</strong> ${timeLeftStr}
                `;
                
            } else {
                // –ì—Ä–∞—Ñ–∏–∫ –∑–∞–∫—Ä—ã—Ç
                statusEl.className = 'status-indicator inactive';
                statusEl.innerHTML = `
                    <span class="icon">üîí</span>
                    <span>–ì—Ä–∞—Ñ–∏–∫ –ó–ê–ö–†–´–¢</span>
                `;
                
                detailsEl.innerHTML = `
                    <strong>–ü–µ—Ä–∏–æ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à—ë–Ω</strong><br>
                    –ë—ã–ª –æ—Ç–∫—Ä—ã—Ç —Å ${openFrom.toLocaleString('ru-RU')}<br>
                    –ø–æ ${openUntil.toLocaleString('ru-RU')}<br><br>
                    –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≥—Ä–∞—Ñ–∏–∫–∞.
                `;
            }
        }



// === –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ ===
async function clearAllBookings() {
    // –î–≤–æ–π–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Äî —á—Ç–æ–±—ã —Å–ª—É—á–∞–π–Ω–æ –Ω–µ —Å—Ç—ë—Ä–ª–∏ –º–µ—Å—è—Ü —Ä–∞–±–æ—Ç—ã
    if (!confirm('–í–ù–ò–ú–ê–ù–ò–ï!\n\n–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –£–î–ê–õ–ò–¢–¨ –í–°–ï –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∑–∞ –í–°–ï –¥–∞—Ç—ã.\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ù–ï–õ–¨–ó–Ø –æ—Ç–º–µ–Ω–∏—Ç—å!\n\n–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
        return;
    }

    if (!confirm('–ü–û–°–õ–ï–î–ù–ï–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï!\n\n–ë—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –í–°–ï –∑–∞–ø–∏—Å–∏ –∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞.\n–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å–º–æ–≥—É—Ç –∑–∞–Ω–æ–≤–æ –≤—Å—ë —Ä–∞—Å—Ö–≤–∞—Ç–∞—Ç—å.\n\n–í—ã —É–≤–µ—Ä–µ–Ω—ã –Ω–∞ 100%?')) {
        return;
    }

    try {
        // –£–¥–∞–ª—è–µ–º –í–°–ï –∑–∞–ø–∏—Å–∏ –∏–∑ schedule_bookings
        const { error } = await supabaseClient
            .from('schedule_bookings')
            .delete()
            .gt('id', 0); // —É—Å–ª–æ–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤—Å–µ–≥–¥–∞ –∏—Å—Ç–∏–Ω–Ω–æ ‚Äî —É–¥–∞–ª—è–µ–º –≤—Å—ë

        if (error) throw error;

        showToast('–í–µ—Å—å –≥—Ä–∞—Ñ–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω! –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –º–æ–≥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ.', 'success');
        
        // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏–ª–∏ —Ç–∞–±–ª–∏—Ü—É, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
        console.log('–í—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã');
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –≥—Ä–∞—Ñ–∏–∫–∞:', error);
        showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: ' + error.message, 'error');
    }
}


        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –Ω–∞ –Ω–µ–¥–µ–ª—é
        function generateRequirementsTable() {
            const weekStartDay = parseInt(document.getElementById('weekStartDay').value || '1');
            const today = new Date();
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏
            const daysUntilStart = (weekStartDay - today.getDay() + 7) % 7 || 7;
            const nextWeekStart = new Date(today);
            nextWeekStart.setDate(today.getDate() + daysUntilStart);
            
            let html = '<thead><tr><th>–î–µ–Ω—å</th>';
            
            // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —á–∞—Å–æ–≤
            for (let hour = 0; hour < 24; hour++) {
                html += `<th>${hour.toString().padStart(2, '0')}:00</th>`;
            }
            html += '</tr></thead><tbody>';
            
            // –°—Ç—Ä–æ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
            for (let day = 0; day < 7; day++) {
                const currentDate = new Date(nextWeekStart);
                currentDate.setDate(nextWeekStart.getDate() + day);
                const dateStr = currentDate.toISOString().split('T')[0];
                const dayName = daysOfWeek[currentDate.getDay()];
                
                html += `<tr>`;
                html += `<td class="day-name">${dayName}<br>${currentDate.toLocaleDateString('ru-RU', {day: 'numeric', month: 'numeric'})}</td>`;
                
                for (let hour = 0; hour < 24; hour++) {
                    html += `
                        <td class="requirement-cell">
                            <input type="number" 
                                   class="requirement-cell-input" 
                                   id="req_${dateStr}_${hour}"
                                   data-date="${dateStr}"
                                   data-hour="${hour}"
                                   min="0" 
                                   max="99"
                                   value="0">
                        </td>
                    `;
                }
                html += '</tr>';
            }
            html += '</tbody>';
            
            document.getElementById('requirementsTable').innerHTML = html;
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –Ω–∞ –Ω–µ–¥–µ–ª—é
        async function loadWeekRequirements() {
            const weekStartDay = parseInt(document.getElementById('weekStartDay').value || '1');
            const today = new Date();
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏
            const daysUntilStart = (weekStartDay - today.getDay() + 7) % 7 || 7;
            const nextWeekStart = new Date(today);
            nextWeekStart.setDate(today.getDate() + daysUntilStart);
            
            const nextWeekEnd = new Date(nextWeekStart);
            nextWeekEnd.setDate(nextWeekStart.getDate() + 6);
            
            try {
                const { data, error } = await supabaseClient
                    .from('slot_requirements')
                    .select('*')
                    .gte('date', nextWeekStart.toISOString().split('T')[0])
                    .lte('date', nextWeekEnd.toISOString().split('T')[0]);
                
                if (error) throw error;
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–∞–Ω–Ω—ã–º–∏
                data.forEach(req => {
                    const inputEl = document.getElementById(`req_${req.date}_${req.hour_slot}`);
                    if (inputEl) {
                        inputEl.value = req.required_count;
                    }
                });
                
            } catch (error) {
                console.error('Error loading week requirements:', error);
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π', 'error');
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
        async function saveAllRequirements() {
            const inputs = document.querySelectorAll('.requirement-cell-input');
            const updates = [];
            
            inputs.forEach(input => {
                const date = input.dataset.date;
                const hour = parseInt(input.dataset.hour);
                const value = parseInt(input.value) || 0;
                
                updates.push({
                    date: date,
                    hour_slot: hour,
                    required_count: value
                });
            });
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–∞—Ç—ã
                const dates = [...new Set(updates.map(u => u.date))];
                
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —ç—Ç–∏—Ö –¥–∞—Ç
                for (const date of dates) {
                    await supabaseClient
                        .from('slot_requirements')
                        .delete()
                        .eq('date', date);
                }
                
                // –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
                const { error } = await supabaseClient
                    .from('slot_requirements')
                    .insert(updates);
                
                if (error) throw error;
                
                showToast('–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
            } catch (error) {
                console.error('Error saving requirements:', error);
                showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
            }
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–Ω—è
        function copyDayRequirements() {
            const selectedDay = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–Ω—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è (1-7):');
            if (!selectedDay || selectedDay < 1 || selectedDay > 7) {
                showToast('–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –¥–Ω—è', 'error');
                return;
            }
            
            const dayIndex = parseInt(selectedDay) - 1;
            const inputs = document.querySelectorAll('.requirement-cell-input');
            
            copiedDayRequirements = [];
            for (let hour = 0; hour < 24; hour++) {
                const input = inputs[dayIndex * 24 + hour];
                if (input) {
                    copiedDayRequirements.push(parseInt(input.value) || 0);
                }
            }
            
            showToast('–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–Ω—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        }
        
        // –í—Å—Ç–∞–≤–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–Ω—è
        function pasteDayRequirements() {
            if (!copiedDayRequirements) {
                showToast('–°–Ω–∞—á–∞–ª–∞ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –¥–µ–Ω—å', 'error');
                return;
            }
            
            const selectedDay = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–Ω—è –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ (1-7):');
            if (!selectedDay || selectedDay < 1 || selectedDay > 7) {
                showToast('–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –¥–Ω—è', 'error');
                return;
            }
            
            const dayIndex = parseInt(selectedDay) - 1;
            const inputs = document.querySelectorAll('.requirement-cell-input');
            
            for (let hour = 0; hour < 24; hour++) {
                const input = inputs[dayIndex * 24 + hour];
                if (input && copiedDayRequirements[hour] !== undefined) {
                    input.value = copiedDayRequirements[hour];
                }
            }
            
            showToast('–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—Å—Ç–∞–≤–ª–µ–Ω—ã', 'success');
        }
        
        async function updateScheduleSettings() {
            const openFrom = document.getElementById('scheduleOpenFrom').value;
            const openUntil = document.getElementById('scheduleOpenUntil').value;
            
            if (!openFrom || !openUntil) {
                showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±–∞ –ø–æ–ª—è –≤—Ä–µ–º–µ–Ω–∏', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞—Ç
            if (new Date(openFrom) >= new Date(openUntil)) {
                showToast('–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–∑–∂–µ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞', 'error');
                return;
            }
            
            try {
                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                const { error: error1 } = await supabaseClient
                    .from('system_settings')
                    .update({ 
                        setting_value: openFrom.replace('T', ' ') + ':00',
                        updated_at: new Date().toISOString()
                    })
                    .eq('setting_key', 'schedule_open_from');
                
                if (error1) throw error1;
                
                const { error: error2 } = await supabaseClient
                    .from('system_settings')
                    .update({ 
                        setting_value: openUntil.replace('T', ' ') + ':00',
                        updated_at: new Date().toISOString()
                    })
                    .eq('setting_key', 'schedule_open_until');
                
                if (error2) throw error2;
                
                // –í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º is_schedule_active –≤ true
                const { error: error3 } = await supabaseClient
                    .from('system_settings')
                    .update({ 
                        setting_value: 'true',
                        updated_at: new Date().toISOString()
                    })
                    .eq('setting_key', 'is_schedule_active');
                
                if (error3) throw error3;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                scheduleSettings.schedule_open_from = openFrom.replace('T', ' ') + ':00';
                scheduleSettings.schedule_open_until = openUntil.replace('T', ' ') + ':00';
                scheduleSettings.is_schedule_active = 'true';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                updateScheduleStatus();
                
                showToast('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
            } catch (error) {
                console.error('Error updating settings:', error);
                showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫: ' + error.message, 'error');
            }
        }
        
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏, —ç–∫—Å–ø–æ—Ä—Ç –∏ —Ç.–¥.)
        async function loadEmployees() {
            try {
                const { data, error } = await supabaseClient
                    .from('employees')
                    .select('*')
                    .eq('is_active', true)
                    .order('sort_order');
                
                if (error) throw error;
                
                employees = data;
                updateEmployeesList();
            } catch (error) {
                console.error('Error loading employees:', error);
            }
        }
        
        function updateEmployeesList() {
            const listEl = document.getElementById('employeesList');
            const countEl = document.getElementById('employeeCount');
            
            countEl.textContent = employees.length;
            
            if (employees.length === 0) {
                listEl.innerHTML = '<p style="color: #999; text-align: center;">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</p>';
                return;
            }
            
            listEl.innerHTML = employees.map((emp, index) => `
                <div class="employee-item">
                    <span class="employee-name">${index + 1}. ${emp.full_name}</span>
                    <button class="delete-btn" onclick="deleteEmployee(${emp.id})">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `).join('');
        }
        
        async function addEmployee() {
            const nameInput = document.getElementById('newEmployeeName');
            const name = nameInput.value.trim();
            
            if (!name) {
                showToast('–í–≤–µ–¥–∏—Ç–µ –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞', 'error');
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('employees')
                    .insert([{ 
                        full_name: name,
                        sort_order: employees.length + 1
                    }]);
                
                if (error) throw error;
                
                nameInput.value = '';
                await loadEmployees();
                showToast('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
            } catch (error) {
                console.error('Error adding employee:', error);
                showToast('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞', 'error');
            }
        }
        
        async function addBulkEmployees() {
            const textarea = document.getElementById('bulkEmployees');
            const names = textarea.value.trim().split('\n').filter(n => n.trim());
            
            if (names.length === 0) {
                showToast('–í–≤–µ–¥–∏—Ç–µ –∏–º–µ–Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤', 'error');
                return;
            }
            
            try {
                const newEmployees = names.map((name, index) => ({
                    full_name: name.trim(),
                    sort_order: employees.length + index + 1
                }));
                
                const { error } = await supabaseClient
                    .from('employees')
                    .insert(newEmployees);
                
                if (error) throw error;
                
                textarea.value = '';
                await loadEmployees();
                showToast(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${names.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`, 'success');
            } catch (error) {
                console.error('Error adding bulk employees:', error);
                showToast('–û—à–∏–±–∫–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è', 'error');
            }
        }
        
        async function deleteEmployee(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞? –í—Å–µ –µ–≥–æ –∑–∞–ø–∏—Å–∏ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('employees')
                    .update({ is_active: false })
                    .eq('id', id);
                
                if (error) throw error;
                
                await loadEmployees();
                showToast('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–¥–∞–ª–µ–Ω', 'success');
            } catch (error) {
                console.error('Error deleting employee:', error);
                showToast('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
            }
        }
        
        async function clearAllEmployees() {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï–• —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) {
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('employees')
                    .update({ is_active: false })
                    .eq('is_active', true);
                
                if (error) throw error;
                
                await loadEmployees();
                showToast('–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —É–¥–∞–ª–µ–Ω—ã', 'success');
            } catch (error) {
                console.error('Error clearing employees:', error);
                showToast('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
            }
        }
        
        function handleExcelFile(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    
                    const names = jsonData
                        .map(row => row[0])
                        .filter(name => name && typeof name === 'string');
                    
                    if (names.length === 0) {
                        showToast('–ù–µ –Ω–∞–π–¥–µ–Ω–æ –∏–º–µ–Ω –≤ —Ñ–∞–π–ª–µ', 'error');
                        return;
                    }
                    
                    const newEmployees = names.map((name, index) => ({
                        full_name: name.trim(),
                        sort_order: employees.length + index + 1
                    }));
                    
                    const { error } = await supabaseClient
                        .from('employees')
                        .insert(newEmployees);
                    
                    if (error) throw error;
                    
                    await loadEmployees();
                    showToast(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${names.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤`, 'success');
                    input.value = '';
                } catch (error) {
                    console.error('Error processing Excel:', error);
                    showToast('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Excel —Ñ–∞–π–ª–∞', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
        async function exportToExcel() {
            const dateFrom = document.getElementById('exportDateFrom').value;
            const dateTo = document.getElementById('exportDateTo').value;
            
            if (!dateFrom || !dateTo) {
                showToast('–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
                return;
            }
            
            try {
                const { data: bookings, error: bookError } = await supabaseClient
                    .from('schedule_bookings')
                    .select(`
                        *,
                        employees(full_name)
                    `)
                    .gte('date', dateFrom)
                    .lte('date', dateTo)
                    .order('date')
                    .order('hour_slot');
                
                if (bookError) throw bookError;
                
                const { data: requirements, error: reqError } = await supabaseClient
                    .from('slot_requirements')
                    .select('*')
                    .gte('date', dateFrom)
                    .lte('date', dateTo);
                
                if (reqError) throw reqError;
                
                const workbook = XLSX.utils.book_new();
                const scheduleData = [];
                const dates = [...new Set(bookings.map(b => b.date))].sort();
                
                dates.forEach(date => {
                    scheduleData.push([new Date(date).toLocaleDateString('ru-RU')]);
                    
                    const headers = ['–°–æ—Ç—Ä—É–¥–Ω–∏–∫'];
                    for (let h = 0; h < 24; h++) {
                        headers.push(`${h.toString().padStart(2, '0')}:00`);
                    }
                    scheduleData.push(headers);
                    
                    const employeesInDate = [...new Set(bookings.filter(b => b.date === date).map(b => b.employees.full_name))];
                    
                    employeesInDate.forEach(empName => {
                        const row = [empName];
                        for (let h = 0; h < 24; h++) {
                            const isBooked = bookings.some(b => 
                                b.date === date && 
                                b.hour_slot === h && 
                                b.employees.full_name === empName
                            );
                            row.push(isBooked ? '‚úì' : '');
                        }
                        scheduleData.push(row);
                    });
                    
                    const summaryRow = ['–ò–¢–û–ì–û'];
                    for (let h = 0; h < 24; h++) {
                        const count = bookings.filter(b => b.date === date && b.hour_slot === h).length;
                        const required = requirements.find(r => r.date === date && r.hour_slot === h)?.required_count || 0;
                        summaryRow.push(`${count}/${required}`);
                    }
                    scheduleData.push(summaryRow);
                    scheduleData.push([]);
                });
                
                const ws = XLSX.utils.aoa_to_sheet(scheduleData);
                XLSX.utils.book_append_sheet(workbook, ws, '–ì—Ä–∞—Ñ–∏–∫');
                
                XLSX.writeFile(workbook, `–ì—Ä–∞—Ñ–∏–∫_${dateFrom}_${dateTo}.xlsx`);
                showToast('–§–∞–π–ª Excel —Å–æ–∑–¥–∞–Ω', 'success');
            } catch (error) {
                console.error('Error exporting to Excel:', error);
                showToast('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
            }
        }
        
        async function exportToCSV() {
            const dateFrom = document.getElementById('exportDateFrom').value;
            const dateTo = document.getElementById('exportDateTo').value;
            
            if (!dateFrom || !dateTo) {
                showToast('–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
                return;
            }
            
            try {
                const { data: bookings, error } = await supabaseClient
                    .from('schedule_bookings')
                    .select(`
                        *,
                        employees(full_name)
                    `)
                    .gte('date', dateFrom)
                    .lte('date', dateTo)
                    .order('date')
                    .order('hour_slot');
                
                if (error) throw error;
                
                let csv = '–î–∞—Ç–∞,–ß–∞—Å,–°–æ—Ç—Ä—É–¥–Ω–∏–∫\n';
                bookings.forEach(b => {
                    csv += `${b.date},${b.hour_slot}:00,${b.employees.full_name}\n`;
                });
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `–ì—Ä–∞—Ñ–∏–∫_${dateFrom}_${dateTo}.csv`;
                link.click();
                
                showToast('CSV —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω', 'success');
            } catch (error) {
                console.error('Error exporting to CSV:', error);
                showToast('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
            }
        }
        
        async function exportToJSON() {
            const dateFrom = document.getElementById('exportDateFrom').value;
            const dateTo = document.getElementById('exportDateTo').value;
            
            if (!dateFrom || !dateTo) {
                showToast('–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
                return;
            }
            
            try {
                const { data, error } = await supabaseClient
                    .from('schedule_bookings')
                    .select(`
                        *,
                        employees(*)
                    `)
                    .gte('date', dateFrom)
                    .lte('date', dateTo)
                    .order('date')
                    .order('hour_slot');
                
                if (error) throw error;
                
                const json = JSON.stringify(data, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `–ì—Ä–∞—Ñ–∏–∫_${dateFrom}_${dateTo}.json`;
                link.click();
                
                showToast('JSON —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω', 'success');
            } catch (error) {
                console.error('Error exporting to JSON:', error);
                showToast('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
            }
        }
        
        async function exportCurrentWeek() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1));
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            document.getElementById('exportDateFrom').value = startOfWeek.toISOString().split('T')[0];
            document.getElementById('exportDateTo').value = endOfWeek.toISOString().split('T')[0];
            
            await exportToExcel();
        }
        
        async function exportNextWeek() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const startOfNextWeek = new Date(today);
            startOfNextWeek.setDate(today.getDate() - dayOfWeek + 8);
            const endOfNextWeek = new Date(startOfNextWeek);
            endOfNextWeek.setDate(startOfNextWeek.getDate() + 6);
            
            document.getElementById('exportDateFrom').value = startOfNextWeek.toISOString().split('T')[0];
            document.getElementById('exportDateTo').value = endOfNextWeek.toISOString().split('T')[0];
            
            await exportToExcel();
        }
        
        function setDefaultDates() {
            const today = new Date();
            document.getElementById('exportDateFrom').value = today.toISOString().split('T')[0];
            document.getElementById('exportDateTo').value = new Date(today.getTime() + 6 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
        }
        
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', () => {
            if (liveTimeInterval) {
                clearInterval(liveTimeInterval);
            }
        });
    </script>
</body>
</html>
